function saveText(n,t){var r=".content-editor[data-content-id='"+n.Key+"'] .text-editor",i=$(r).trumbowyg("html");i!=null&&$("#editor-content #list-"+t+" #_contentBody_"+t).val(i)}function saveLink(n,t){var i=".content-editor[data-content-id='"+n.Key+"'] .link-editor",r=$(i+" #link-url").val(),u=$(i+" #link-name").val();r!=null&&($("#editor-content #list-"+t+" #_contentName_"+t).val(u),$("#editor-content #list-"+t+" #_contentBody_"+t).val(r))}function saveImage(n,t){var r=".content-editor[data-content-id='"+n.Key+"'] .image-gallery",i=$(r+" .selected #_imagePath").val();i!=null&&$("#editor-content #list-"+t+" #_contentImage_"+t).val(i)}function saveHeader(n,t){var r=".content-editor[data-content-id='"+n.Key+"'] .name-field",i=$(r).val();i!=null&&$("#editor-content #list-"+t+" #_contentName_"+t).val(i)}function saveEditor(){var i,n,t;if(_model.currentType!==_pageType.Page&&_model.currentType===_pageType.Section)for(i=0;i<_model.contentModels.length;i++)n=_model.contentModels[i],t=i+1,n.Type===_contentType.Text?(saveHeader(n,t),saveText(n,t)):n.Type===_contentType.Image?saveImage(n,t):n.Type===_contentType.Link?saveLink(n,t):n.Type===_contentType.Slide&&(saveHeader(n,t),saveText(n,t),saveImage(n,t)),_model.contentModels[i]=n}function checkEditor(){var i=!1,n,t,r;if(_model.currentType!=_pageType.Page&&_model.currentType==_pageType.Section)for(n=0;n<_model.contentModels.length;n++)if(t=_model.contentModels[n],r=n+1,t.Type==_contentType.Text||t.Type==_contentType.Slide){var u=$(".content-editor[data-content-id='"+t.Key+"'] .text-editor"),f=$("#editor-content #list-"+r+" #_contentBody_"+r).val(),e=$(u).trumbowyg("html");f!=e&&($("#save-modal").modal("show"),i=!0)}return i||($("#_saveChanges").val(!1),$(".editor-form").submit()),i}const _pageType={Page:"Page",Section:"Section"},_contentType={Text:"Text",Image:"Image",Link:"Link",Slide:"Slide"};$(window).on("beforeunload",function(){if(checkEditor())return"There are unsaved changes on this page. Would you like to save your progress before leaving?"});$(document).ready(function(){var u,i,t,n,r,f;if(_model.currentType==_pageType.Section)for(t=0;t<_model.contentModels.length;t++)n=_model.contentModels[t],(n.Type==_contentType.Text||n.Type==_contentType.Slide)&&(u=$(".content-editor[data-content-id='"+n.Key+"'] .name-field"),i=$(".content-editor[data-content-id='"+n.Key+"'] .text-editor"),$(i).trumbowyg({removeformatPasted:!0,tagsToRemove:["script","link"],tagsToKeep:["i","script[src]","video"],autogrow:!0,autogrowOnEnter:!0,urlProtocol:!0,btns:[["historyUndo","historyRedo"],["formatting","removeformat"],["strong","em","del"],["superscript","subscript"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["link","specialChars"],["viewHTML","fullscreen"]]}),$(i).trumbowyg("html",n.Body),$(i).attr("spellcheck","true"),$(u).val(n.Name),$(u).attr("spellcheck","true"));if(_model.currentType==_pageType.Section)for(t=0;t<_model.contentModels.length;t++)n=_model.contentModels[t],(n.Type==_contentType.Image||n.Type==_contentType.Slide)&&(r=t+1,f=$("#editor-content #list-"+r+" #_contentImage_"+r).val(),f!=""&&$("#editor-content #list-"+r+" .image-gallery .card").each(function(n,t){var i=$(t).find("#_imagePath").val();f==i&&$(this).addClass("selected")}));$(".hierarchy").treeview({data:_model.displayString,enableLinks:!0,showTags:!0});$(".hierarchy .node-page .link-page").click(function(n){var t,i,r;n.preventDefault();t=$(this).attr("id");$("#_selectedPageKey").val(t);i=null;$("#_selectedSectionKey").val(i);r=$(this).parent().find(".node-type:first").text();$("#_selectedEditorType").val(r);checkEditor()});$(".hierarchy .node-page .link-section").click(function(n){var t,i,r;n.preventDefault();t=$(".node-page.node-selected .link-page").attr("id");$("#_selectedPageKey").val(t);i=$(this).attr("id");$("#_selectedSectionKey").val(i);r=$(this).parent().find(".node-type:first").text();$("#_selectedEditorType").val(r);checkEditor()});$(".editor-submit").click(function(n){n.preventDefault();saveEditor();$("#save-modal").modal("hide");$("#_saveChanges").val(!0);$(".editor-form").submit()});$(".editor-discard").click(function(n){n.preventDefault();$("#save-modal").modal("hide");$("#_saveChanges").val(!1);$(".editor-form").submit()});$(".select-image").click(function(n){n.preventDefault();$(".image-gallery .card").each(function(){$(this).hasClass("selected")&&$(this).removeClass("selected")});$(this).parent().parent().parent().addClass("selected")})});
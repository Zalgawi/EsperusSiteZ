function saveText(n,t){var r=".content-editor[data-content-id='"+n.Key+"'] .text-editor",i=$(r).trumbowyg("html");i!=null&&$("#editor-content #list-"+t+" #_contentBody_"+t).val(i)}function saveLink(n,t){var r=".content-editor[data-content-id='"+n.Key+"'] .link-editor",i=$(r+" #link-url").val();i!=null&&$("#editor-content #list-"+t+" #_contentBody_"+t).val(i)}function saveImage(n,t){var r=".content-editor[data-content-id='"+n.Key+"'] .image-gallery",i=$(r+" .selected #_imagePath").val();i!=null&&$("#editor-content #list-"+t+" #_contentImage_"+t).val(i)}function saveEditor(){var t,n,i;if(_model.currentType!==_pageType.Page&&_model.currentType===_pageType.Section)for(t=0;t<_model.contentModels.length;t++)n=_model.contentModels[t],i=t+1,n.Type===_contentType.Text?saveText(n,i):n.Type===_contentType.Image?saveImage(n,i):n.Type===_contentType.Link?saveLink(n,i):n.Type===_contentType.Slide&&(saveText(n,i),saveImage(n,i)),_model.contentModels[t]=n}function checkEditor(){var i=!1,n,t,r;if(_model.currentType==_pageType.Page||_model.currentType==_pageType.Section)for(n=0;n<_model.contentModels.length;n++)if(t=_model.contentModels[n],r=n+1,t.Type==_contentType.Text||t.Type==_contentType.Slide){var u=$(".content-editor[data-content-id='"+t.Key+"'] .text-editor"),f=$("#editor-content #list-"+r+" #_contentBody_"+r).val(),e=$(u).trumbowyg("html");f!=e&&($("#save-modal").modal("show"),i=!0)}return i||($("#_saveChanges").val(!1),$(".editor-form").submit()),i}const _pageType={Page:"Page",Section:"Section"},_contentType={Text:"Text",Image:"Image",Link:"Link",Slide:"Slide"};$(window).on("beforeunload",function(){if(checkEditor())return"There are unsaved changes on this page. Would you like to save your progress before leaving?"});$(document).ready(function(){var i,n,t,r,u;if(_model.currentType==_pageType.Section)for(n=0;n<_model.contentModels.length;n++)t=_model.contentModels[n],(t.Type==_contentType.Text||t.Type==_contentType.Slide)&&(i=$(".content-editor[data-content-id='"+t.Key+"'] .text-editor"),$(i).trumbowyg({removeformatPasted:!0,tagsToRemove:["script","link"],tagsToKeep:["i","script[src]","video"],autogrow:!0,autogrowOnEnter:!0,urlProtocol:!0,btns:[["historyUndo","historyRedo"],["formatting","removeformat"],["strong","em","del"],["superscript","subscript"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["link","specialChars"],["viewHTML","fullscreen"]]}),$(i).trumbowyg("html",t.Body),$(i).attr("spellcheck","true"));if(_model.currentType==_pageType.Section)for(n=0;n<_model.contentModels.length;n++)t=_model.contentModels[n],(t.Type==_contentType.Image||t.Type==_contentType.Slide)&&(r=n+1,u=$("#editor-content #list-"+r+" #_contentImage_"+r).val(),u!=""&&$("#editor-content #list-"+r+" .image-gallery .card").each(function(n,t){var i=$(t).find("#_imagePath").val();u==i&&$(this).addClass("selected")}));$(".hierarchy").treeview({data:_model.displayString,enableLinks:!0,showTags:!0});$(".hierarchy .node-page .link-page").click(function(n){var t,i,r;n.preventDefault();t=$(this).attr("id");$("#_selectedPageKey").val(t);i=null;$("#_selectedSectionKey").val(i);r=$(this).parent().find(".node-type:first").text();$("#_selectedEditorType").val(r);checkEditor()});$(".hierarchy .node-page .link-section").click(function(n){var t,i,r;n.preventDefault();t=$(".node-page.node-selected .link-page").attr("id");$("#_selectedPageKey").val(t);i=$(this).attr("id");$("#_selectedSectionKey").val(i);r=$(this).parent().find(".node-type:first").text();$("#_selectedEditorType").val(r);checkEditor()});$(".editor-submit").click(function(n){n.preventDefault();saveEditor();$("#save-modal").modal("hide");$("#_saveChanges").val(!0);$(".editor-form").submit()});$(".editor-discard").click(function(n){n.preventDefault();$("#save-modal").modal("hide");$("#_saveChanges").val(!1);$(".editor-form").submit()});$(".submit-image").click(function(n){n.preventDefault();$(".image-gallery .card").each(function(){$(this).hasClass("selected")&&$(this).removeClass("selected")});$(this).parent().parent().addClass("selected")})});